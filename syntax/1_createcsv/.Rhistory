library(readxl)
library(tidyverse)
library(readr)
#open fs sub indicators
FSsubindicators <- read_excel("C:/RBD_CHIPC_dataprocessing/data/raw/CH_2021/March 2021/Outcome_dataset.xlsx")
CH_outcomes <- read_excel("C:/RBD_CHIPC_dataprocessing/data/raw/CH_2021/March 2021/Outcome_dataset.xlsx")
glimpse(CH_outcomes)
table(CH_outcomes$ADMIN0Name)
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
table(bfa_mar2021_cur)
glimpse(bfa_mar2021_cur)
glimpse(CH_outcomes)
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>% rename(adm1 = ADMIN1Name, adm2 = ADMIN2Name)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_curr, -Nutrition_curr, -Mort_curr) %>% rename(adm1 = ADMIN1Name, adm2 = ADMIN2Name)
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>% rename(adm1 = ADMIN1Name, adm2 = ADMIN2Name)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_curr, -Nutrition_curr, -Mort_curr) %>% rename(adm1 = ADMIN1Name, adm2 = ADMIN2Name)
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur %>% left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
View(bfa_mar2021_cur)
names(bfa_mar2021_cur)
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>% rename(adm2 = ADMIN2Name)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_curr, -Nutrition_curr, -Mort_curr) %>% rename(adm2 = ADMIN2Name)
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
glimpse(bfa_mar2021_cur)
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2") %>% select(-country)
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2") %>% select(-country)
View(bfa_mar2021_cur)
names(CH_outcomes)
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2") %>% select(-country, -ADMIN0Name, ADMIN1Name)
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>% rename(adm2 = ADMIN2Name)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_curr, -Nutrition_curr, -Mort_curr) %>% rename(adm2 = ADMIN2Name)
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2") %>% select(-country, -ADMIN0Name, ADMIN1Name)
View(bfa_mar2021_cur)
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>% rename(adm2 = ADMIN2Name)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_curr, -Nutrition_curr, -Mort_curr) %>% rename(adm2 = ADMIN2Name)
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
View(bfa_mar2021_cur)
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>% rename(adm2 = ADMIN2Name)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_curr, -Nutrition_curr, -Mort_curr) %>% rename(adm2 = ADMIN2Name)
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2") %>% select(-ADMIN0Name, ADMIN1Name)
View(bfa_mar2021_cur)
names(CH_outcomes)
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2") %>% select(-ADMIN0Name, -ADMIN1Name)
View(bfa_mar2021_cur)
names(CH_outcomes_cur)
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_curr, livelihoods = EME_Curr, nutrition = Nutrition_Curr, mortality = Mort_Curr)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_curr, -Nutrition_curr, -Mort_curr) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_proj, livelihoods = EME_proj, nutrition = Nutrition_proj, mortality = Mort_proj)
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2") %>% select(-ADMIN0Name, -ADMIN1Name)
View(bfa_mar2021_cur)
#join projected
sux1 <- anti_join(bfa_mar2021_proj, CH_outcomes_proj, by = "adm2")
bfa_mar2021_proj <- left_join(bfa_mar2021_proj, CH_outcomes_proj, by = "adm2") %>% select(-ADMIN0Name, -ADMIN1Name)
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_curr, livelihoods = EME_Curr, nutrition = Nutrition_Curr, mortality = Mort_Curr)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_curr, -Nutrition_curr, -Mort_curr) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_proj, livelihoods = EME_proj, nutrition = Nutrition_proj, mortality = Mort_proj)
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2") %>% select(-ADMIN0Name, -ADMIN1Name)
#join projected
sux1 <- anti_join(bfa_mar2021_proj, CH_outcomes_proj, by = "adm2")
bfa_mar2021_proj <- left_join(bfa_mar2021_proj, CH_outcomes_proj, by = "adm2") %>% select(-ADMIN0Name, -ADMIN1Name)
sux1 <- anti_join(bfa_mar2021_proj, CH_outcomes_proj, by = "adm2")
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_curr, -Nutrition_curr, -Mort_curr) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_proj, livelihoods = EME_proj, nutrition = Nutrition_proj, mortality = Mort_proj)
#open fs sub indicators
CH_outcomes <- read_excel("C:/RBD_CHIPC_dataprocessing/data/raw/CH_2021/March 2021/Outcome_dataset.xlsx")
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_curr, livelihoods = EME_Curr, nutrition = Nutrition_Curr, mortality = Mort_Curr)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_curr, -Nutrition_curr, -Mort_curr) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_proj, livelihoods = EME_proj, nutrition = Nutrition_proj, mortality = Mort_proj)
glimpse(CH_outcomes)
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_curr, livelihoods = EME_Curr, nutrition = Nutrition_Curr, mortality = Mort_Curr)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_Curr, -Nutrition_curr, -Mort_curr) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_proj, livelihoods = EME_proj, nutrition = Nutrition_proj, mortality = Mort_proj)
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_curr, livelihoods = EME_Curr, nutrition = Nutrition_Curr, mortality = Mort_Curr)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_Curr, -Nutrition_curr, -Mort_curr) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_proj, livelihoods = EME_proj, nutrition = Nutrition_proj, mortality = Mort_proj)
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_curr, livelihoods = EME_Curr, nutrition = Nutrition_Curr, mortality = Mort_Curr)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_Curr, -Nutrition_Curr, -Mort_curr) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_proj, livelihoods = EME_proj, nutrition = Nutrition_proj, mortality = Mort_proj)
#open fs sub indicators
CH_outcomes <- read_excel("C:/RBD_CHIPC_dataprocessing/data/raw/CH_2021/March 2021/Outcome_dataset.xlsx")
#open matrice intermediares
#do this later
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_curr, livelihoods = EME_Curr, nutrition = Nutrition_Curr, mortality = Mort_Curr)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_Curr, -Nutrition_Curr, -Mort_Curr) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_proj, livelihoods = EME_proj, nutrition = Nutrition_proj, mortality = Mort_proj)
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2") %>% select(-ADMIN0Name, -ADMIN1Name)
#join projected
sux1 <- anti_join(bfa_mar2021_proj, CH_outcomes_proj, by = "adm2")
bfa_mar2021_proj <- left_join(bfa_mar2021_proj, CH_outcomes_proj, by = "adm2") %>% select(-ADMIN0Name, -ADMIN1Name)
View(bfa_mar2021_proj)
#Cote Divoire
civ_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_cur.csv")
civ_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_proj.csv")
#join current
sux1 <- anti_join(civ_mar2021_cur, CH_outcomes_cur, by = "adm2")
View(civ_mar2021_cur)
#Cote Divoire
civ_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_cur.csv")
civ_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_proj.csv")
#join current
sux1 <- anti_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name"))
#join current
sux1 <- anti_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name"))
civ_mar2021_cur <- left_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name")) %>% select(-ADMIN0Name, -ADMIN1Name)
#join projected
civ_mar2021_cur <- left_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name"))
View(civ_mar2021_proj)
View(civ_mar2021_cur)
names(civ_mar2021_cur)
names(sux1)
View(civ_mar2021_cur)
civ_mar2021_cur <- left_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name"))
names(civ_mar2021_cur)
#Cote Divoire
civ_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_cur.csv")
civ_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_proj.csv")
#join current
sux1 <- anti_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name"))
civ_mar2021_cur <- left_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name")) %>% select()
names(sux1)
names(civ_mar2021_cur)
#Cote Divoire
civ_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_cur.csv")
civ_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_proj.csv")
#join current
sux1 <- anti_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name"))
civ_mar2021_cur <- left_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name"))
names(civ_mar2021_cur)
#Cote Divoire
civ_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_cur.csv")
civ_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_proj.csv")
#join current
sux1 <- anti_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name"))
civ_mar2021_cur <- left_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name")) %>% select(-ADMIN0Name,-adm2.y) %>% rename(adm2 = adm2.y)
#Cote Divoire
civ_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_cur.csv")
civ_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_proj.csv")
#join current
sux1 <- anti_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name"))
civ_mar2021_cur <- left_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name")) %>% select(-ADMIN0Name,-adm2.y) %>% rename(adm2 = adm2.x)
#join projected
#Cote Divoire
civ_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_cur.csv")
civ_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_proj.csv")
#join current
sux1 <- anti_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name"))
civ_mar2021_cur <- left_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name")) %>% select(-ADMIN0Name,-adm2.y) %>% rename(adm2 = adm2.x)
#join projected
sux1 <- anti_join(civ_mar2021_proj, CH_outcomes_proj, c("adm1" = "ADMIN1Name"))
civ_mar2021_proj <- left_join(civ_mar2021_proj, CH_outcomes_proj, c("adm1" = "ADMIN1Name")) %>% select(-ADMIN0Name,-adm2.y) %>% rename(adm2 = adm2.x)
View(civ_mar2021_cur)
install.packages("naniar")
#open CH outcome data
CH_outcomes <- read_excel("C:/RBD_CHIPC_dataprocessing/data/raw/CH_2021/March 2021/Outcome_dataset.xlsx")
#replace 0 with NA
CH_outcomes <- CH_outcomes %>%  replace_with_na_at(.vars = CA_curr:Mort_proj, condition = ~ exp(.x) = 0)
CH_outcomes <- CH_outcomes %>%  replace_with_na_at(.vars = CA_curr:Mort_proj, condition = ~ exp(.x) == 0)
library(readxl)
library(tidyverse)
library(readr)
library(naniar)
#replace 0 with NA
CH_outcomes <- CH_outcomes %>%  replace_with_na_at(.vars = CA_curr:Mort_proj, condition = ~ exp(.x) = 0)
#replace 0 with NA
CH_outcomes <- CH_outcomes %>%  replace_with_na_at(.vars = CA_curr:Mort_proj, condition = ~ exp(.x) == 0)
CH_outcomes <- CH_outcomes %>% mutate_at(vars(CA_curr:Mort_proj), ~replace(., . == 0, NA))
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_curr, livelihoods = EME_Curr, nutrition = Nutrition_Curr, mortality = Mort_Curr)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_Curr, -Nutrition_Curr, -Mort_Curr) %>%
rename(adm2 = ADMIN2Name, food_consumption = CA_proj, livelihoods = EME_proj, nutrition = Nutrition_proj, mortality = Mort_proj)
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2") %>% select(-ADMIN0Name, -ADMIN1Name)
#join projected
sux1 <- anti_join(bfa_mar2021_proj, CH_outcomes_proj, by = "adm2")
bfa_mar2021_proj <- left_join(bfa_mar2021_proj, CH_outcomes_proj, by = "adm2") %>% select(-ADMIN0Name, -ADMIN1Name)
#write
bfa_mar2021_cur %>% write_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj %>% write_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#Cote Divoire
civ_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_cur.csv")
civ_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_proj.csv")
#join current
sux1 <- anti_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name"))
civ_mar2021_cur <- left_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name")) %>% select(-ADMIN0Name,-adm2.y) %>% rename(adm2 = adm2.x)
#join projected
sux1 <- anti_join(civ_mar2021_proj, CH_outcomes_proj, c("adm1" = "ADMIN1Name"))
civ_mar2021_proj <- left_join(civ_mar2021_proj, CH_outcomes_proj, c("adm1" = "ADMIN1Name")) %>% select(-ADMIN0Name,-adm2.y) %>% rename(adm2 = adm2.x)
View(civ_mar2021_proj)
library(readxl)
library(tidyverse)
library(readr)
#open CH outcome data
CH_outcomes <- read_excel("C:/RBD_CHIPC_dataprocessing/data/raw/CH_2021/March 2021/Outcome_dataset.xlsx")
#replace 0 with NA
CH_outcomes <- CH_outcomes %>% mutate_at(vars(CA_curr:Mort_proj), ~replace(., . == 0, NA))
#open matrice intermediares
#do this later
#select only current outcome indicators
CH_outcomes_cur <- CH_outcomes %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>%
rename(adm2 = ADMIN2Name, fc_phase_consumption = CA_curr, lh_phaselihoods = EME_Curr, nut_phase = Nutrition_Curr, mort_phase = Mort_Curr)
CH_outcomes_proj <- CH_outcomes %>% select(-CA_curr, -EME_Curr, -Nutrition_Curr, -Mort_Curr) %>%
rename(adm2 = ADMIN2Name, fc_phase_consumption = CA_proj, lh_phaselihoods = EME_proj, nut_phase = Nutrition_proj, mort_phase = Mort_proj)
#pullup and match country by country
#Burkina
bfa_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#join current
sux1 <- anti_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2")
bfa_mar2021_cur <- left_join(bfa_mar2021_cur, CH_outcomes_cur, by = "adm2") %>% select(-ADMIN0Name, -ADMIN1Name)
#join projected
sux1 <- anti_join(bfa_mar2021_proj, CH_outcomes_proj, by = "adm2")
bfa_mar2021_proj <- left_join(bfa_mar2021_proj, CH_outcomes_proj, by = "adm2") %>% select(-ADMIN0Name, -ADMIN1Name)
#write
bfa_mar2021_cur %>% write_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_cur.csv")
bfa_mar2021_proj %>% write_csv("C:/RBD_CHIPC_dataprocessing/data/csv/BFA/bfa_mar2021_proj.csv")
#Cote Divoire
civ_mar2021_cur <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_cur.csv")
civ_mar2021_proj <- read_csv("C:/RBD_CHIPC_dataprocessing/data/csv/civ/civ_mar2021_proj.csv")
#join current
sux1 <- anti_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name"))
civ_mar2021_cur <- left_join(civ_mar2021_cur, CH_outcomes_cur, c("adm1" = "ADMIN1Name")) %>% select(-ADMIN0Name,-adm2.y) %>% rename(adm2 = adm2.x)
#join projected
sux1 <- anti_join(civ_mar2021_proj, CH_outcomes_proj, c("adm1" = "ADMIN1Name"))
civ_mar2021_proj <- left_join(civ_mar2021_proj, CH_outcomes_proj, c("adm1" = "ADMIN1Name")) %>% select(-ADMIN0Name,-adm2.y) %>% rename(adm2 = adm2.x)
library(tidyverse)
library(stringr)
library(sf)
library(readxl)
library(writexl)
library(fs)
library(stringdist)
library(googledrive)
library(googlesheets4)
## File template
file_regex <- "^\\w{3}_(mar|nov|jun)\\d{4}_(cur|proj)\\.csv"
##
files <- dir_ls("data/csv", type = "file", recurse = TRUE)
## Check if all files follow the patterns
stopifnot(all(str_detect(basename(files), file_regex)))
files[which(!str_detect(basename(files), file_regex))]
## Remove June
#files <- files[!str_detect(files, "jun")]
exercise_code <- function(file) {
case_when(
str_detect(file, "nov") ~ 1L,
str_detect(file, "mar") ~ 2L,
str_detect(file, "jun") ~ 3L,
TRUE ~ 0L
)
}
exercise_label <- function(file) {
case_when(
str_detect(file, "nov") ~ "Sep-Dec",
str_detect(file, "mar") ~ "Jan-May",
str_detect(file, "jun") ~ "Jun-Aug",
TRUE ~ ""
)
}
exercise_year <- function(file)
as.integer(str_extract(file, "\\d{4}"))
reference_code <- function(file) {
if_else(str_detect(file, "proj"), if_else(str_detect(file, "nov2014"), 2L, 3L), exercise_code(file))
}
reference_label <- function(file) {
if_else(str_detect(file, "proj"), if_else(str_detect(file, "nov2014"), "Jan-May", "Jun-Aug"), exercise_label(file))
}
reference_year <- function(file) {
ex_year <- exercise_year(file)
ex_code <- exercise_code(file)
if_else(str_detect(file, "proj") & ex_code == 1L, ex_year + 1L, ex_year)
}
guess_file_encoding <- function(file) {
guess_encoding(file) %>%
slice(1) %>%
pull(encoding)
}
dd <- map(files, function(l) {
df <- suppressMessages(read_csv(l, locale = locale(encoding = guess_file_encoding(l))))
df$exercise_year <- exercise_year(l)
df$exercise_code <- exercise_code(l)
df$reference_year <- reference_year(l)
df$reference_code <- reference_code(l)
df$exercise_label <- exercise_label(l)
df$reference_label <- reference_label(l)
df$chtype <- if_else(str_detect(l, "proj"), "projected", "current")
df
})
## Bind all data
df <- bind_rows(dd)
## Remove accent and replace them by non ascii version
df$country <- iconv(str_to_title(df$country), from = "UTF-8", to = "ASCII//TRANSLIT")
df$country[str_which(df$country, regex("ivoire", ignore_case = TRUE))] <- "Cote d'Ivoire"
df$region <- iconv(str_to_title(df$region), from = "UTF-8",to = "ASCII//TRANSLIT")
df$adm1 <- iconv(str_to_title(df$adm1), from = "UTF-8", to = "ASCII//TRANSLIT")
df$adm2 <- iconv(str_to_title(df$adm2), from = "UTF-8", to = "ASCII//TRANSLIT")
### Rename columns
all <- df %>%
filter(!is.na(classif)) %>%
select(adm0_name = country, region, adm1_name = adm1, adm2_name = adm2,
population = pop, phase_class = classif, phase1:phase35,
chtype, exercise_code, exercise_label, exercise_year, reference_code, reference_label, reference_year, status, fc_phase, lh_phase,	nut_phase,	mort_phase,
FCG_Poor,	FCG_Borderline,	FCG_Acceptable,	FCG_finalphase,	HDDS_Phase1,	HDDS_Phase2,	HDDS_Phase3,	HDDS_Phase4,	HDDS_Phase5,	HDDS_finalphase,	HHS_Phase1,	HHS_Phase2,	HHS_Phase3,	HHS_Phase4,	HHS_Phase5,
HHS_finalphase,	NoStrategies,	StressStrategies,	CrisisStrategies,	EmergencyStrategies,	LhHCSCat_finalphase,	rCSI_Phase1,	rCSI_Phase2,	rCSI_Phase3,	rCSI_finalphase)
library(readxl)
library(tidyverse)
library(readr)
#open CH outcome data - without Nigeria
Outcome_without_Nigeria <- read_excel("data/raw/CH_2021/March 2021/Outcome_with_new_data_of_Guinea.xlsx")
#replace 0 with NA
Outcome_without_Nigeria <- Outcome_without_Nigeria %>% mutate_at(vars(CA_curr:Mort_proj), ~replace(., . == 0, NA))
#select only current outcome indicators
Outcome_without_Nigeria_cur <- Outcome_without_Nigeria %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>%
rename(adm1 = ADMIN1Name, adm2 = ADMIN2Name,  foodconsumption_phase = CA_curr, livelihoods_phase = EME_Curr, nutrition_phase = Nutrition_Curr, mortality_phase = Mort_Curr)
Outcome_without_Nigeria_proj <- Outcome_without_Nigeria %>% select(-CA_curr, -EME_Curr, -Nutrition_Curr, -Mort_Curr) %>%
rename(adm1 = ADMIN1Name, adm2 = ADMIN2Name,  foodconsumption_phase = CA_proj, livelihoods_phase = EME_proj, nutrition_phase = Nutrition_proj, mortality_phase = Mort_proj)
#open CH outcome data - with Nigeria
Outcome_Nigeria <- read_excel("data/raw/CH_2021/March 2021/Outcome_Nigeria_Last_version.xlsx")
#replace 0 with NA
Outcome_Nigeria <- Outcome_Nigeria %>% mutate_at(vars(CA_curr:Mort_proj), ~replace(., . == 0, NA))
#select only current outcome indicators
Outcome_Nigeria_cur <- Outcome_Nigeria %>% select(-CA_proj, -EME_proj, -Nutrition_proj, -Mort_proj) %>%
rename(adm1 = ADMIN1Name, adm2 = ADMIN2Name,  foodconsumption_phase = CA_curr, livelihoods_phase = EME_Curr, nutrition_phase = Nutrition_Curr, mortality_phase = Mort_Curr)
Outcome_Nigeria_proj <- Outcome_Nigeria %>% select(-CA_curr, -EME_Curr, -Nutrition_Curr, -Mort_Curr) %>%
rename(adm1 = ADMIN1Name, adm2 = ADMIN2Name,  foodconsumption_phase = CA_proj, livelihoods_phase = EME_proj, nutrition_phase = Nutrition_proj, mortality_phase = Mort_proj)
